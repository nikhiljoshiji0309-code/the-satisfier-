<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Living Universe ‚ö°</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
    margin:0;padding:0;overflow:hidden;
    background:#050505;
    font-family:Arial Black,sans-serif;
    color:white;
}
canvas{display:block}

/* UI */
#ui{
    position:fixed;
    top:15px;left:15px;
    z-index:10;
    font-size:13px;
    color:#00ffff;
}
#ui span{display:block;margin-bottom:6px}

.menu{
    position:fixed;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:8px;
    z-index:10;
}
button{
    padding:10px 14px;
    background:rgba(0,0,0,.7);
    border:1px solid #00ffff;
    color:#00ffff;
    cursor:pointer;
}
button.active,button:hover{
    background:#00ffff;
    color:#000;
}

/* Overlays */
.overlay{
    position:fixed;inset:0;
    background:radial-gradient(circle,#000 0%,#050505 70%);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:20;
}
.hidden{display:none}
.panel{
    border:1px solid #00ffff;
    padding:24px;
    background:rgba(0,0,0,.75);
    text-align:center;
    max-width:340px;
}
.panel h1{margin:0 0 10px;color:#00ffff}
.panel p{font-size:12px;opacity:.85}
</style>
</head>

<body>
<canvas id="c"></canvas>

<div id="ui">
    <span id="modeLabel">MODE: VISUAL</span>
    <span id="scoreUI"></span>
    <span id="bestUI"></span>
</div>

<div class="menu">
    <button id="visualBtn" class="active" onclick="setMode('visual')">VISUAL</button>
    <button id="gameBtn" onclick="setMode('game')">GAME</button>
</div>

<div id="start" class="overlay hidden">
    <div class="panel">
        <h1>ELECTRIC SURVIVAL</h1>
        <p>
            Move to survive<br>
            Click / Tap ‚Üí Shockwave<br>
            One hit = end
        </p>
        <button onclick="startGame()">START</button>
    </div>
</div>

<div id="gameover" class="overlay hidden">
    <div class="panel">
        <h1>CORE DESTROYED</h1>
        <p id="finalScore"></p>
        <button onclick="restart()">RESTART</button>
    </div>
</div>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
resize();window.addEventListener("resize",resize);
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}

/* ========= AUDIO SYSTEM ========= */
const AudioCtx=window.AudioContext||window.webkitAudioContext;
const audio=new AudioCtx();

let visualMusic=null;
let gameMusic=null;

function startVisualMusic(){
    stopMusic();
    visualMusic=audio.createOscillator();
    const g=audio.createGain();
    visualMusic.type="sine";
    visualMusic.frequency.value=80;
    g.gain.value=0.03;
    visualMusic.connect(g);
    g.connect(audio.destination);
    visualMusic.start();
}

function startGameMusic(){
    stopMusic();
    gameMusic=audio.createOscillator();
    const g=audio.createGain();
    gameMusic.type="sawtooth";
    gameMusic.frequency.value=140;
    g.gain.value=0.05;
    gameMusic.connect(g);
    g.connect(audio.destination);
    gameMusic.start();
}

function stopMusic(){
    if(visualMusic){visualMusic.stop();visualMusic=null}
    if(gameMusic){gameMusic.stop();gameMusic=null}
}

function sfx(f,t="square",v=.08,d=.15){
    const o=audio.createOscillator(),g=audio.createGain();
    o.type=t;o.frequency.value=f;g.gain.value=v;
    g.gain.exponentialRampToValueAtTime(.0001,audio.currentTime+d);
    o.connect(g);g.connect(audio.destination);
    o.start();o.stop(audio.currentTime+d);
}

/* ========= MODE ========= */
let mode="visual";
function setMode(m){
    audio.resume();
    mode=m;
    modeLabel.textContent="MODE: "+m.toUpperCase();
    visualBtn.classList.toggle("active",m==="visual");
    gameBtn.classList.toggle("active",m==="game");

    if(m==="visual"){
        startVisualMusic();
        start.classList.add("hidden");
    }
    if(m==="game"){
        stopMusic();
        start.classList.remove("hidden");
    }
}

/* ========= INPUT ========= */
const mouse={x:innerWidth/2,y:innerHeight/2};
window.addEventListener("mousemove",e=>{mouse.x=e.clientX;mouse.y=e.clientY});
window.addEventListener("touchmove",e=>{
    mouse.x=e.touches[0].clientX;
    mouse.y=e.touches[0].clientY;
},{passive:false});
window.addEventListener("mousedown",()=>{audio.resume();sfx(120)});
window.addEventListener("touchstart",()=>{audio.resume();sfx(120)});

/* ========= VISUAL MODE ========= */
let particles=[];
class Particle{
    constructor(x,y){
        this.x=x;this.y=y;
        this.vx=Math.random()*4-2;
        this.vy=Math.random()*4-2;
        this.life=1;
        this.size=Math.random()*4+2;
        this.color=`hsl(${Math.random()*360},100%,70%)`;
    }
    update(){
        let dx=mouse.x-this.x,dy=mouse.y-this.y;
        let d=Math.hypot(dx,dy)||1;
        this.vx+=dx/d*.02;
        this.vy+=dy/d*.02;
        this.x+=this.vx;this.y+=this.vy;
        this.life-=.006;
        if(this.x<0)this.x=canvas.width;
        if(this.x>canvas.width)this.x=0;
        if(this.y<0)this.y=canvas.height;
        if(this.y>canvas.height)this.y=0;
    }
    draw(){
        ctx.globalAlpha=this.life;
        ctx.fillStyle=this.color;
        ctx.beginPath();
        ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
        ctx.fill();
    }
}

/* ========= GAME MODE ========= */
let running=false;
let enemies=[];
let score=0;
let best=localStorage.getItem("best")||0;
bestUI.textContent="üèÜ BEST: "+best;

function startGame(){
    audio.resume();
    startGameMusic();
    start.classList.add("hidden");
    running=true;
    score=0;
}

function endGame(){
    running=false;
    stopMusic();
    gameover.classList.remove("hidden");
    finalScore.innerHTML=`Score: <b>${score}</b>`;
    if(score>best){
        best=score;
        localStorage.setItem("best",best);
        bestUI.textContent="üèÜ BEST: "+best;
    }
}

function restart(){
    enemies=[];
    gameover.classList.add("hidden");
    startGame();
}

/* ========= LOOP ========= */
function loop(){
    ctx.fillStyle="rgba(0,0,25,.3)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    if(mode==="visual"){
        if(Math.random()<.35)particles.push(new Particle(mouse.x,mouse.y));
        particles.forEach((p,i)=>{
            p.update();p.draw();
            if(p.life<=0)particles.splice(i,1);
        });
    }

    if(mode==="game" && running){
        score++;
        scoreUI.textContent="‚ö° SCORE: "+score;

        ctx.fillStyle="#00ffff";
        ctx.beginPath();
        ctx.arc(mouse.x,mouse.y,10,0,Math.PI*2);
        ctx.fill();
    }

    requestAnimationFrame(loop);
}
loop();

/* Auto-start visual music after first interaction */
window.addEventListener("click",()=>startVisualMusic(),{once:true});
</script>
</body>
</html>
